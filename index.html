<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>STEPS – FETP Scale-up Decision Aid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="app-header-main">
        <div>
          <h1>STEPS – Scalable Training Estimation and Planning System</h1>
          <p class="app-subtitle">
            Decision support for scaling Field Epidemiology Training Programs (FETP) in India.
          </p>
        </div>
        <div class="app-badge">
          <span>Prototype owner</span>
          <strong>Mesfin Genie, PhD<br />Newcastle Business School</strong>
        </div>
      </div>
      <div class="app-meta">
        <span>Powered by discrete choice experiment evidence and costing templates (WHO, NIE, NCDC)</span>
      </div>
    </header>

    <nav class="tab-bar">
      <button class="tab-button active" data-tab-target="tab-intro">Introduction</button>
      <button class="tab-button" data-tab-target="tab-config">Configuration</button>
      <button class="tab-button" data-tab-target="tab-results">Results</button>
      <button class="tab-button" data-tab-target="tab-sensitivity">Sensitivity</button>
      <button class="tab-button" data-tab-target="tab-simulation">National Simulation</button>
      <button class="tab-button" data-tab-target="tab-dashboard">Saved Scenarios</button>
      <button class="tab-button" data-tab-target="tab-about">About & Methods</button>
    </nav>

    <main class="tab-container">
      <!-- INTRO TAB -->
      <section id="tab-intro" class="tab-section active">
        <div class="card-grid">
          <section class="card">
            <h2>What STEPS does</h2>
            <p>
              STEPS is an interactive tool that helps Indian decision makers explore options for scaling Field
              Epidemiology Training Programs (FETP). It links three ingredients:
            </p>
            <ul class="bullet-list">
              <li>Preferences from a discrete choice experiment (DCE) with 214 FETP stakeholders.</li>
              <li>Cost templates from WHO, NIE and NCDC for frontline, intermediate and advanced FETP.</li>
              <li>Simple epidemiological and economic multipliers to approximate benefits of additional trained epidemiologists.</li>
            </ul>
            <p>
              Users can configure program attributes, explore expected endorsement (uptake), see cost and benefit
              implications, and compare alternative scale-up strategies.
            </p>
          </section>

          <section class="card">
            <h2>How to read the results</h2>
            <ol class="numbered-list">
              <li>
                <strong>Choose a configuration</strong> in the configuration tab (program level, mentorship, response
                time, delivery mode, cost per trainee per month, and cohort size).
              </li>
              <li>
                <strong>Apply configuration</strong> to update endorsement probability, economic costs and approximate
                benefits.
              </li>
              <li>
                <strong>Review the headline recommendation</strong> which summarises whether the configuration looks
                attractive or not based on benefit cost ratio (BCR) and expected uptake.
              </li>
              <li>
                <strong>Save scenarios</strong> with short notes, and export results for World Bank and Ministry
                discussions.
              </li>
            </ol>
            <p>
              A separate technical appendix is available from the About and Methods tab, which gives full model
              details, equations and references.
            </p>
          </section>

          <section class="card">
            <h2>Key modelling assumptions</h2>
            <ul class="bullet-list">
              <li>
                Uptake is derived from a mixed logit (MXL) model and a two class latent class (LC) model with
                lognormal cost, estimated in Stata on the FETP India DCE.
              </li>
              <li>
                Cost per trainee per month must stay within the DCE range of ₹75,000 to ₹400,000 to keep
                predictions valid.
              </li>
              <li>
                Epidemiological benefits are stylised but anchored in evidence that trained field epidemiologists
                strengthen early detection, outbreak response and routine surveillance.
              </li>
            </ul>
            <button id="openTechnicalBtn" class="btn-secondary">
              Open technical appendix (new window)
            </button>
          </section>
        </div>
      </section>

      <!-- CONFIG TAB -->
      <section id="tab-config" class="tab-section">
        <div class="layout-two-column">
          <section class="card">
            <h2>Programme configuration</h2>
            <div class="form-grid">
              <div class="form-field">
                <label for="programmeType">Programme type / tier</label>
                <select id="programmeType">
                  <option value="frontline">Frontline (3 months)</option>
                  <option value="intermediate">Intermediate (12 months)</option>
                  <option value="advanced">Advanced (24 months)</option>
                </select>
                <p class="field-hint">
                  Based on the three tier FETP model used in India.
                </p>
              </div>

              <div class="form-field">
                <label for="careerIncentive">Career incentive</label>
                <select id="careerIncentive">
                  <option value="certificate">Government and partner certificate</option>
                  <option value="university">University qualification</option>
                  <option value="gov_career">Government career pathway</option>
                </select>
              </div>

              <div class="form-field">
                <label for="mentorship">Mentorship intensity</label>
                <select id="mentorship">
                  <option value="low">Low (≥ 5 fellows per mentor)</option>
                  <option value="medium">Medium (3–4 fellows per mentor)</option>
                  <option value="high">High (≤ 2 fellows per mentor)</option>
                </select>
              </div>

              <div class="form-field">
                <label for="deliveryMode">Delivery mode</label>
                <select id="deliveryMode">
                  <option value="blended">Blended</option>
                  <option value="inperson">Fully in person</option>
                  <option value="online">Fully online</option>
                </select>
              </div>

              <div class="form-field">
                <label for="responseTime">Response capacity</label>
                <select id="responseTime">
                  <option value="30">Within 30 days</option>
                  <option value="15">Within 15 days (7 1 7 target)</option>
                  <option value="7">Within 7 days</option>
                </select>
              </div>

              <div class="form-field">
                <label for="costSlider">Cost per trainee per month (INR)</label>
                <input
                  id="costSlider"
                  type="range"
                  min="75000"
                  max="400000"
                  step="5000"
                />
                <div class="slider-row">
                  <span>Range: ₹ 75,000 – ₹ 400,000</span>
                  <span id="costSliderValue" class="slider-value">₹ 250,000</span>
                </div>
                <p class="field-hint">
                  This is the same cost range used in the discrete choice experiment.
                </p>
              </div>

              <div class="form-field">
                <label for="cohortSize">Cohort size (number of trainees)</label>
                <input id="cohortSize" type="number" min="5" max="60" value="20" />
              </div>

              <div class="form-field">
                <label for="numCohorts">Number of cohorts (for national simulation)</label>
                <input id="numCohorts" type="number" min="1" max="200" value="50" />
              </div>

              <div class="form-field">
                <label for="valuePerGrad">Value per fully trained advanced graduate (INR)</label>
                <input id="valuePerGrad" type="number" min="500000" step="50000" value="3000000" />
                <p class="field-hint">
                  Used to translate additional graduates into approximate economic benefits.
                </p>
              </div>

              <div class="form-field">
                <label for="preferenceModel">Preference model</label>
                <select id="preferenceModel">
                  <option value="mxl">Average mixed logit (all stakeholders)</option>
                  <option value="lc2">Training supporters (latent class 2)</option>
                </select>
                <p class="field-hint">
                  Latent class 2 isolates respondents who are generally supportive of FETP training.
                </p>
              </div>

              <div class="form-field">
                <label for="currencySelect">Display currency</label>
                <select id="currencySelect">
                  <option value="INR">INR</option>
                  <option value="USD">USD (converted)</option>
                </select>
              </div>

              <div class="form-field">
                <label>Opportunity cost</label>
                <div class="toggle-row">
                  <span>Include trainee salary opportunity cost</span>
                  <button id="oppCostToggle" class="toggle-switch" type="button" aria-pressed="false">
                    <span class="toggle-thumb"></span>
                  </button>
                </div>
                <p class="field-hint">
                  When on, total cost includes estimated trainee salary opportunity cost using ratios from the cost templates.
                </p>
              </div>

              <div class="form-field">
                <label for="costTemplateSource">Cost template source</label>
                <select id="costTemplateSource">
                  <option value="combined">Combined template (WHO, NIE, NCDC)</option>
                  <option value="who">WHO template</option>
                  <option value="nie">NIE template</option>
                  <option value="ncdc">NCDC template</option>
                </select>
                <p class="field-hint">
                  Source of the cost structure used to scale the cost breakdown. Values are rescaled to match the chosen cost per trainee per month.
                </p>
              </div>

              <div class="form-field form-field-full">
                <label for="scenarioNotes">Scenario notes (for saved scenarios and exports)</label>
                <textarea id="scenarioNotes" rows="3" placeholder="Example: Advanced, high mentorship, 15 day response, 50 cohorts for PM ABHIM phase 1."></textarea>
              </div>
            </div>

            <div class="button-row">
              <button id="applyConfigBtn" class="btn-primary">
                Apply configuration and view results
              </button>
              <button id="saveScenarioBtn" class="btn-outline">
                Save scenario
              </button>
            </div>
          </section>

          <section class="card">
            <h2>Cost structure (per cohort)</h2>
            <p class="card-intro">
              The table below shows how total cohort cost is distributed across major categories. Shares are taken
              from WHO, NIE and NCDC templates and rescaled to match your chosen cost per trainee per month.
            </p>
            <table class="cost-table">
              <thead>
                <tr>
                  <th>Category</th>
                  <th>Share of direct cost</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody id="costBreakdownBody">
                <!-- populated by script.js -->
              </tbody>
            </table>
            <p class="field-hint" id="costTemplateNote">
              The current pattern uses the combined template for the selected programme type. Opportunity cost is shown separately in the results tab.
            </p>
          </section>
        </div>
      </section>

      <!-- RESULTS TAB -->
      <section id="tab-results" class="tab-section">
        <div class="layout-two-column">
          <section class="card">
            <h2>Headline results</h2>
            <p id="headlineRecommendation" class="headline-text">
              Configure a scenario and click “Apply configuration” to generate a recommendation.
            </p>

            <div class="result-grid">
              <div class="result-pill">
                <span class="result-label">Uptake (endorsement) probability</span>
                <span id="resultUptake" class="result-value">–</span>
              </div>
              <div class="result-pill">
                <span class="result-label">Per trainee perceived benefit (DCE)</span>
                <span id="resultBenefitPerTrainee" class="result-value">–</span>
              </div>
              <div class="result-pill">
                <span class="result-label">Total perceived benefit per cohort</span>
                <span id="resultTotalBenefit" class="result-value">–</span>
              </div>
              <div class="result-pill">
                <span class="result-label">Total cost per cohort</span>
                <span id="resultCostCohort" class="result-value">–</span>
              </div>
              <div class="result-pill">
                <span class="result-label">Benefit cost ratio (per cohort)</span>
                <span id="resultBCR" class="result-value">–</span>
              </div>
              <div class="result-pill">
                <span class="result-label">Net benefit per cohort</span>
                <span id="resultNetBenefit" class="result-value">–</span>
              </div>
              <div class="result-pill">
                <span class="result-label">Expected graduates per cohort</span>
                <span id="resultGraduates" class="result-value">–</span>
              </div>
            </div>

            <div class="button-row">
              <button id="openFullResultsBtn" class="btn-secondary">
                Open full results
              </button>
              <button id="downloadPdfBtn" class="btn-outline">
                Download policy brief (PDF)
              </button>
              <button id="downloadExcelBtn" class="btn-outline">
                Download Excel summary
              </button>
            </div>
          </section>

          <section class="card">
            <h2>Charts</h2>
            <div class="chart-block">
              <h3>Uptake and net benefit per cohort</h3>
              <canvas id="uptakeChart"></canvas>
            </div>
            <div class="chart-block">
              <h3>Per trainee benefit vs cost per month</h3>
              <canvas id="benefitChart"></canvas>
            </div>
          </section>
        </div>
      </section>

      <!-- SENSITIVITY TAB -->
      <section id="tab-sensitivity" class="tab-section">
        <section class="card">
          <h2>One way sensitivity analysis</h2>
          <p>
            This plot varies cost per trainee per month by ±20 percent around the chosen value and shows the implied
            uptake and net benefit. It helps assess how sensitive the configuration is to uncertainty in cost
            assumptions.
          </p>
          <canvas id="sensitivityChart"></canvas>
        </section>
      </section>

      <!-- NATIONAL SIM TAB -->
      <section id="tab-simulation" class="tab-section">
        <section class="card">
          <h2>National scale simulation</h2>
          <p>
            This section scales the cohort level results to a national programme with multiple cohorts. It uses the
            same configuration and preference model as in the results tab.
          </p>

          <div class="result-grid">
            <div class="result-pill">
              <span class="result-label">Number of cohorts</span>
              <span id="simNumCohorts" class="result-value">–</span>
            </div>
            <div class="result-pill">
              <span class="result-label">Total cost (all cohorts)</span>
              <span id="simTotalCost" class="result-value">–</span>
            </div>
            <div class="result-pill">
              <span class="result-label">Total perceived benefit (all cohorts)</span>
              <span id="simTotalBenefit" class="result-value">–</span>
            </div>
            <div class="result-pill">
              <span class="result-label">Total expected graduates</span>
              <span id="simTotalGraduates" class="result-value">–</span>
            </div>
            <div class="result-pill">
              <span class="result-label">National net benefit</span>
              <span id="simNetBenefit" class="result-value">–</span>
            </div>
          </div>

          <div class="chart-block">
            <h3>National costs and benefits across cohorts</h3>
            <canvas id="simulationChart"></canvas>
          </div>
        </section>
      </section>

      <!-- DASHBOARD TAB -->
      <section id="tab-dashboard" class="tab-section">
        <section class="card">
          <h2>Saved scenarios and comparison</h2>
          <p>
            Saved scenarios are stored in your browser only. They include configuration, results and any notes you
            provided. Select up to three scenarios to compare.
          </p>
          <table class="scenario-table">
            <thead>
              <tr>
                <th>Select</th>
                <th>Name</th>
                <th>Programme</th>
                <th>Mentorship</th>
                <th>Response</th>
                <th>Cost / trainee / month</th>
                <th>Uptake</th>
                <th>BCR</th>
              </tr>
            </thead>
            <tbody id="savedScenariosBody">
              <!-- populated in script.js -->
            </tbody>
          </table>

          <div class="button-row">
            <button id="compareScenariosBtn" class="btn-secondary">
              Compare selected scenarios
            </button>
            <button id="clearScenariosBtn" class="btn-outline">
              Clear all saved scenarios
            </button>
          </div>

          <div class="chart-block">
            <h3>Comparison of saved scenarios</h3>
            <canvas id="dashboardChart"></canvas>
          </div>
        </section>
      </section>

      <!-- ABOUT TAB -->
      <section id="tab-about" class="tab-section">
        <div class="card-grid">
          <section class="card">
            <h2>About STEPS</h2>
            <p>
              STEPS was developed as part of a business case for scaling Field Epidemiology Training Programs (FETP)
              in India, with a primary focus on advanced FETP and a secondary focus on intermediate FETP. The tool is
              intended to support World Bank and NCDC discussions on how to structure and finance FETP expansion under
              PM ABHIM.
            </p>
            <p>
              The tool combines a discrete choice experiment (DCE) with 214 stakeholders, costing templates from WHO,
              NIE and NCDC, and simple epidemiological multipliers to approximate avoided outbreak losses. All
              monetary values are in INR internally. The currency toggle only affects how figures are displayed.
            </p>
            <p>
              For technical questions please contact:<br />
              <strong>Mesfin Genie, PhD</strong><br />
              Newcastle Business School, The University of Newcastle, Australia<br />
              <a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a>
            </p>
          </section>

          <section class="card">
            <h2>Attributes and levels</h2>
            <ul class="bullet-list">
              <li><strong>Programme type:</strong> Frontline (3 months), Intermediate (12 months), Advanced (24 months).</li>
              <li><strong>Trainee career incentives:</strong> Government and partner certificate, university qualification, government career pathway.</li>
              <li><strong>Mentorship intensity:</strong> Low, medium, or high mentor to fellow ratios.</li>
              <li><strong>Delivery mode:</strong> Blended, fully in person, or fully online.</li>
              <li><strong>Response capacity:</strong> Response within 30, 15 or 7 days after programme completion.</li>
              <li><strong>Cost:</strong> Cost per trainee per month in the range ₹75,000 to ₹400,000.</li>
            </ul>
          </section>

          <section class="card">
            <h2>Methods in brief</h2>
            <p>
              The DCE was analysed using a panel mixed logit model with normally distributed parameters for all
              non cost attributes and a lognormal cost parameter, and a two class latent class logit model. Cost
              coefficients were specified to be strictly negative, allowing economically coherent willingness to pay
              calculations.
            </p>
            <p>
              Uptake in STEPS is computed as the probability that a generic FETP programme is chosen over an opt out
              alternative, using the mean mixed logit coefficients or the preferences of the latent “training
              supporters” class. Per trainee benefit is derived from willingness to pay estimates expressed in INR per
              trainee per month. Cohort and national values multiply these per trainee benefits by cohort size, programme duration and expected uptake.
            </p>
            <p>
              Clicking the button below opens a full technical appendix with model equations, estimation details and
              references in a new window.
            </p>
            <button id="openTechnicalBtn2" class="btn-secondary">
              Open technical appendix (new window)
            </button>
          </section>
        </div>
      </section>
    </main>
  </div>

  <!-- FULL RESULTS MODAL -->
  <div id="resultsModal" class="modal-backdrop hidden" aria-hidden="true">
    <div class="modal-dialog">
      <header class="modal-header">
        <h2>Detailed results for current scenario</h2>
        <button id="closeResultsModalBtn" class="modal-close" aria-label="Close full results">
          ×
        </button>
      </header>
      <div id="resultsModalContent" class="modal-body">
        <!-- populated dynamically -->
      </div>
      <footer class="modal-footer">
        <button id="modalDownloadPdfBtn" class="btn-secondary">
          Download policy brief (PDF)
        </button>
        <button id="modalCloseBtn" class="btn-outline">
          Close
        </button>
      </footer>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
