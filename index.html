<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>STEPS - FETP Scale-up Decision Aid (India)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- App script -->
  <script defer src="script.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="app-header-left">
      <div class="app-logo-circle">S</div>
      <div>
        <h1 class="app-title">STEPS</h1>
        <p className="app-subtitle">Scalable Training Estimation and Planning System – India FETP</p>
      </div>
    </div>
    <div class="app-header-right">
      <span class="badge">Prototype v1.0</span>
    </div>
  </header>

  <main class="app-main">
    <!-- LEFT COLUMN: CONFIG / META -->
    <section class="panel panel-left">
      <!-- Tabs -->
      <nav class="tabs">
        <button class="tab-button active" data-tab="tab-config">Configuration</button>
        <button class="tab-button" data-tab="tab-attributes">Attributes & Levels</button>
        <button class="tab-button" data-tab="tab-costing">Costing</button>
      </nav>

      <!-- CONFIG TAB -->
      <section id="tab-config" class="tab-pane active">
        <h2 class="panel-title">Configure FETP Scenario</h2>
        <p class="panel-intro">
          Select a training configuration. STEPS will use DCE evidence to estimate endorsement,
          benefits and costs for this scenario.
        </p>

        <form id="config-form" class="config-grid" autocomplete="off">
          <!-- Program type -->
          <div class="form-group">
            <label for="program-type">Program type / tier</label>
            <select id="program-type" name="programType">
              <option value="frontline">Frontline (3 months, part-time)</option>
              <option value="intermediate">Intermediate (12–15 months, part-time)</option>
              <option value="advanced">Advanced (24 months, full-time)</option>
            </select>
            <p class="help-text">
              Frontline focuses on basic surveillance; advanced prepares national or state-level leaders.
            </p>
          </div>

          <!-- Career incentives -->
          <div class="form-group">
            <label for="career-incentive">Trainee career incentives</label>
            <select id="career-incentive" name="careerIncentive">
              <option value="certificate">Government & partner certificate</option>
              <option value="uni">University qualification</option>
              <option value="govpath">Government career pathway</option>
            </select>
          </div>

          <!-- Mentorship intensity -->
          <div class="form-group">
            <label for="mentorship">Mentorship intensity (mentor–fellow ratio)</label>
            <select id="mentorship" name="mentorship">
              <option value="low">Low (≥5 fellows per mentor)</option>
              <option value="medium">Medium (3–4 fellows per mentor)</option>
              <option value="high">High (≤2 fellows per mentor)</option>
            </select>
          </div>

          <!-- Delivery mode -->
          <div class="form-group">
            <label for="delivery">Delivery mode</label>
            <select id="delivery" name="delivery">
              <option value="blended">Blended (in-person + online + fieldwork)</option>
              <option value="inperson">Fully in-person</option>
              <option value="online">Fully online</option>
            </select>
          </div>

          <!-- Outbreak response capacity -->
          <div class="form-group">
            <label for="response">Outbreak response capacity after training</label>
            <select id="response" name="response">
              <option value="30">Respond within 30 days</option>
              <option value="15">Respond within 15 days (7-1-7 target)</option>
              <option value="7">Respond within 7 days</option>
            </select>
          </div>

          <!-- Cohort size -->
          <div class="form-group">
            <label for="cohort-size">Cohort size (fellows per cycle)</label>
            <input id="cohort-size" name="cohortSize" type="number" min="5" max="60" step="1" value="20" />
          </div>

          <!-- Cost per trainee per month -->
          <div class="form-group">
            <label for="cost-per-trainee">
              Cost per trainee per month (₹)
            </label>
            <input
              id="cost-per-trainee"
              name="costPerTrainee"
              type="number"
              min="75000"
              max="400000"
              step="5000"
              value="250000"
            />
            <p class="help-text">
              This should sit roughly within the DCE range (₹75,000-₹400,000 per trainee per month).
            </p>
          </div>

          <!-- Source of cost -->
          <div class="form-group">
            <label for="cost-source">Cost data source</label>
            <select id="cost-source" name="costSource">
              <option value="WHO">WHO-based cost template</option>
              <option value="NIE">NIE template</option>
              <option value="NCDC">NCDC template</option>
              <option value="custom">Custom mix</option>
            </select>
          </div>
        </form>

        <div class="actions-row">
          <button id="btn-apply" class="btn btn-primary">Apply configuration &amp; view results</button>
          <button id="btn-save-scenario" class="btn btn-outline">Save scenario</button>
        </div>

        <div class="hint-box">
          <h3>How STEPS uses your inputs</h3>
          <p>
            STEPS combines the configuration here with DCE coefficients
            from the mixed logit model to predict stakeholder endorsement and willingness-to-pay.
          </p>
        </div>
      </section>

      <!-- ATTRIBUTES TAB -->
      <section id="tab-attributes" class="tab-pane">
        <h2 class="panel-title">FETP attributes and DCE levels</h2>
        <p class="panel-intro">
          These are the attributes and levels used in the discrete choice experiment. STEPS uses the
          estimated coefficients and WTP values to generate uptake and benefit estimates.
        </p>

        <div class="attributes-table-wrapper">
          <table class="basic-table">
            <thead>
              <tr>
                <th>Attribute</th>
                <th>Description</th>
                <th>Levels</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Program type</td>
                <td>Tier of FETP training offered</td>
                <td>Frontline, Intermediate, Advanced</td>
              </tr>
              <tr>
                <td>Trainee career incentives</td>
                <td>Credentials and career pathways on completion</td>
                <td>Government & partner certificate, University qualification, Government career pathway</td>
              </tr>
              <tr>
                <td>Mentorship intensity</td>
                <td>Mentor–fellow ratio during training</td>
                <td>Low (≥5), Medium (3–4), High (≤2)</td>
              </tr>
              <tr>
                <td>Delivery mode</td>
                <td>How training is delivered</td>
                <td>Blended, Fully in-person, Fully online</td>
              </tr>
              <tr>
                <td>Outbreak response capacity</td>
                <td>Ability of graduates to detect and respond after training</td>
                <td>Within 30 days, 15 days, 7 days</td>
              </tr>
              <tr>
                <td>Cost per trainee per month</td>
                <td>Monthly cost per trainee, in ₹000s in the DCE</td>
                <td>₹75,000; ₹100,000; ₹250,000; ₹350,000; ₹400,000</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="info-card">
          <h3>How ASCs are treated</h3>
          <p>
            The DCE included an alternative-specific constant for Training A (left-hand option) and an
            ASC for the opt-out. In STEPS, the Training A ASC is used as a generic “programme” intercept,
            while the opt-out ASC anchors the probability of endorsing any FETP configuration versus
            choosing “neither”.
          </p>
        </div>
      </section>

      <!-- COSTING TAB -->
      <section id="tab-costing" class="tab-pane">
        <h2 class="panel-title">Costing structure</h2>
        <p class="panel-intro">
          Cost estimates are drawn from WHO, NIE and NCDC templates for frontline, intermediate
          and advanced FETP tiers. STEPS uses your chosen cost per trainee per month for the
          main calculations, with these templates providing context.
        </p>

        <div class="cost-cards">
          <article class="cost-card">
            <h3>Frontline (illustrative)</h3>
            <p class="cost-total">
              Approx. total per cohort: <span id="cost-frontline-cohort">₹17,400,000</span>
            </p>
            <ul class="cost-list">
              <li>In-country staff and management</li>
              <li>Workshops, seminars and training materials</li>
              <li>In-country travel for fellows and mentors</li>
              <li>Office space, utilities and shared services</li>
              <li>Opportunity cost of trainees’ time</li>
            </ul>
          </article>

          <article class="cost-card">
            <h3>Intermediate (illustrative)</h3>
            <p class="cost-total">
              Approx. total per cohort: <span id="cost-intermediate-cohort">₹288,000,000</span>
            </p>
            <ul class="cost-list">
              <li>Staff salaries (WHO, NIE, NCDC templates)</li>
              <li>Domestic and international travel</li>
              <li>Workshops, seminars and other direct costs</li>
              <li>Management, in-kind contributions and overheads</li>
            </ul>
          </article>

          <article class="cost-card">
            <h3>Advanced (illustrative)</h3>
            <p class="cost-total">
              Approx. total per cohort: <span id="cost-advanced-cohort">₹289,000,000</span>
            </p>
            <ul class="cost-list">
              <li>Stipends and equipment for fellows</li>
              <li>Intensive travel and field placements</li>
              <li>International engagements and supervision</li>
              <li>Management and institutional overheads</li>
            </ul>
          </article>
        </div>

        <div class="toggle-row">
          <label class="toggle">
            <input type="checkbox" id="include-opportunity-cost" checked />
            <span class="toggle-slider"></span>
          </label>
          <span class="toggle-label">
            Include trainees’ opportunity costs in “cost per trainee per month” interpretation
          </span>
        </div>
      </section>
    </section>

    <!-- RIGHT COLUMN: RESULTS / DASHBOARD -->
    <section class="panel panel-right">
      <nav class="tabs tabs-secondary">
        <button class="tab-button-secondary active" data-tab="tab-summary">Summary</button>
        <button class="tab-button-secondary" data-tab="tab-full-results">Full results</button>
        <button class="tab-button-secondary" data-tab="tab-sensitivity">Sensitivity</button>
        <button class="tab-button-secondary" data-tab="tab-simulation">National simulation</button>
        <button class="tab-button-secondary" data-tab="tab-report">Saved scenarios &amp; export</button>
      </nav>

      <!-- SUMMARY TAB -->
      <section id="tab-summary" class="tab-pane-secondary active">
        <h2 class="panel-title">Scenario snapshot</h2>

        <div class="summary-grid">
          <div class="summary-card">
            <h3>Endorsement</h3>
            <p class="summary-value" id="summary-uptake">0%</p>
            <p class="summary-label">Predicted probability that stakeholders endorse this FETP configuration rather than “neither”.</p>
          </div>
          <div class="summary-card">
            <h3>Benefit–cost ratio</h3>
            <p class="summary-value" id="summary-bcr">0.00</p>
            <p class="summary-label">Value of perceived socio-economic benefits per ₹1 of programme cost.</p>
          </div>
          <div class="summary-card">
            <h3>Net benefit per cohort</h3>
            <p class="summary-value" id="summary-net-benefit">₹0</p>
            <p class="summary-label">Total benefits minus total costs for one cohort (over full programme duration).</p>
          </div>
        </div>

        <div class="chart-row">
          <canvas id="chart-uptake-bar"></canvas>
        </div>
        <div class="chart-row">
          <canvas id="chart-benefit-vs-cost"></canvas>
        </div>
      </section>

      <!-- FULL RESULTS TAB -->
      <section id="tab-full-results" class="tab-pane-secondary">
        <div class="results-header">
          <h2 class="panel-title">Detailed results</h2>
          <button id="btn-show-modal" class="btn btn-ghost">Open results as popup</button>
        </div>

        <div class="results-grid">
          <div>
            <h3>Key indicators</h3>
            <ul class="results-list">
              <li><strong>Utility of programme:</strong> <span id="res-utility">0.000</span></li>
              <li><strong>Utility of opt-out:</strong> <span id="res-utility-optout">0.000</span></li>
              <li><strong>Endorsement probability:</strong> <span id="res-uptake">0%</span></li>
              <li><strong>Per trainee benefit per month:</strong> <span id="res-benefit-per-trainee">₹0</span></li>
              <li><strong>Total benefit per cohort:</strong> <span id="res-total-benefit">₹0</span></li>
              <li><strong>Total cost per cohort:</strong> <span id="res-total-cost">₹0</span></li>
              <li><strong>BCR:</strong> <span id="res-bcr">0.00</span></li>
              <li><strong>Net benefit per cohort:</strong> <span id="res-net-benefit">₹0</span></li>
            </ul>
          </div>
          <div>
            <h3>Scenario configuration</h3>
            <ul class="results-list" id="res-config-list"></ul>
          </div>
        </div>
      </section>

      <!-- SENSITIVITY TAB -->
      <section id="tab-sensitivity" class="tab-pane-secondary">
        <h2 class="panel-title">Sensitivity to costs</h2>
        <p class="panel-intro">
          This plot varies the cost per trainee per month by ±20 percent around the current value and
          shows how endorsement and the benefit–cost ratio change.
        </p>
        <canvas id="chart-sensitivity"></canvas>
      </section>

      <!-- NATIONAL SIMULATION TAB -->
      <section id="tab-simulation" class="tab-pane-secondary">
        <h2 class="panel-title">National scale-up simulation</h2>
        <p class="panel-intro">
          Explore the implications of rolling out this configuration across multiple cohorts.
        </p>

        <div class="simulation-controls">
          <div class="form-group-inline">
            <label for="num-cohorts">Number of cohorts</label>
            <input id="num-cohorts" type="number" min="1" max="500" step="1" value="50" />
          </div>
        </div>

        <div class="summary-grid">
          <div class="summary-card">
            <h3>Total national cost</h3>
            <p class="summary-value" id="sim-total-cost">₹0</p>
          </div>
          <div class="summary-card">
            <h3>Total national benefit</h3>
            <p class="summary-value" id="sim-total-benefit">₹0</p>
          </div>
          <div class="summary-card">
            <h3>National net benefit</h3>
            <p class="summary-value" id="sim-total-net-benefit">₹0</p>
          </div>
        </div>

        <div class="chart-row">
          <canvas id="chart-simulation"></canvas>
        </div>
      </section>

      <!-- REPORT / SAVED SCENARIOS TAB -->
      <section id="tab-report" class="tab-pane-secondary">
        <h2 class="panel-title">Saved scenarios and export</h2>
        <p class="panel-intro">
          Save multiple STEPS configurations, compare them, and export a short policy brief (PDF)
          or an Excel file for further analysis.
        </p>

        <div class="saved-scenarios">
          <table class="basic-table" id="saved-table">
            <thead>
              <tr>
                <th>Scenario</th>
                <th>Programme</th>
                <th>Endorsement</th>
                <th>BCR</th>
                <th>Net benefit / cohort</th>
              </tr>
            </thead>
            <tbody>
              <!-- Filled dynamically -->
            </tbody>
          </table>
        </div>

        <div class="compare-row">
          <div class="form-group-inline">
            <label for="compare-a">Compare scenario A</label>
            <select id="compare-a"></select>
          </div>
          <div class="form-group-inline">
            <label for="compare-b">Compare scenario B</label>
            <select id="compare-b"></select>
          </div>
        </div>

        <div class="chart-row">
          <canvas id="chart-compare"></canvas>
        </div>

        <div class="actions-row">
          <button id="btn-export-pdf" class="btn btn-primary">Download PDF brief</button>
          <button id="btn-export-excel" class="btn btn-outline">Download Excel</button>
        </div>
      </section>
    </section>
  </main>

  <!-- RESULTS MODAL -->
  <div id="results-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <h2>STEPS scenario results</h2>
      <p class="modal-lead">
        This popup summarises the DCE-based endorsement, benefits and costs
        for the current configuration.
      </p>
      <div class="results-grid modal-results-grid">
        <div>
          <h3>Key numbers</h3>
          <ul class="results-list">
            <li><strong>Endorsement probability:</strong> <span id="modal-uptake">0%</span></li>
            <li><strong>Per trainee benefit per month:</strong> <span id="modal-benefit-per-trainee">₹0</span></li>
            <li><strong>Total benefit per cohort:</strong> <span id="modal-total-benefit">₹0</span></li>
            <li><strong>Total cost per cohort:</strong> <span id="modal-total-cost">₹0</span></li>
            <li><strong>Benefit–cost ratio:</strong> <span id="modal-bcr">0.00</span></li>
            <li><strong>Net benefit per cohort:</strong> <span id="modal-net-benefit">₹0</span></li>
          </ul>
        </div>
        <div>
          <h3>Programme description</h3>
          <ul class="results-list" id="modal-config-list"></ul>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
