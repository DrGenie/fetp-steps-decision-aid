<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>STEPS - FETP Scale-up Decision Aid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="app-title-group">
      <h1>STEPS</h1>
      <p class="app-subtitle">
        Scalable Training Estimation and Planning System for FETP in India
      </p>
    </div>
    <div class="app-meta">
      <p><strong>Lead:</strong> Mesfin Genie, PhD</p>
      <p>Newcastle Business School, The University of Newcastle, Australia</p>
      <p><a href="mailto:mesfin.genie@newcastle.edu.au">mesfin.genie@newcastle.edu.au</a></p>
    </div>
  </header>

  <nav class="tab-nav">
    <button class="tab-button active" data-tab="aboutTab">About</button>
    <button class="tab-button" data-tab="configTab">Configure scenario</button>
    <button class="tab-button" data-tab="resultsTab">Results</button>
    <button class="tab-button" data-tab="libraryTab">Scenario library</button>
    <button class="tab-button" data-tab="costTab">Cost templates</button>
  </nav>

  <main class="app-main">
    <!-- ABOUT / METHODS -->
    <section id="aboutTab" class="tab-panel active">
      <div class="card">
        <h2>What STEPS does</h2>
        <p>
          STEPS is a planning tool to explore different Field Epidemiology Training Program (FETP) scale up options
          in India. It combines:
        </p>
        <ul>
          <li>Discrete choice experiment (DCE) evidence on stakeholder preferences for FETP design</li>
          <li>Detailed cost templates for frontline, intermediate and advanced FETP tiers</li>
          <li>Simple epidemiological and economic summary outputs for each scenario</li>
        </ul>
        <p>
          The tool helps users compare alternative configurations in terms of expected endorsement,
          costs, and social value, and to understand the implications of scaling up to multiple cohorts
          at national level.
        </p>
      </div>

      <div class="card">
        <h2>How to use STEPS</h2>
        <ol>
          <li>Go to <strong>Configure scenario</strong> and select programme design, cost and scale.</li>
          <li>Check the estimated endorsement, costs and benefit-cost ratio in <strong>Results</strong>.</li>
          <li>Save configurations into the <strong>Scenario library</strong> for later comparison.</li>
          <li>Download a short <strong>policy brief PDF</strong> or an <strong>Excel summary</strong> for reporting.</li>
        </ol>
        <p>
          All DCE-based quantities are driven by the mixed logit (MXL) model and the latent class model.
          Methods and coefficient tables are described in the technical appendix.
        </p>
        <p>
          For full econometric and epidemiological details, including model equations, estimation methods
          and references, see the technical appendix:
        </p>
        <p>
          <a href="docs/STEPS_technical_appendix.pdf" target="_blank">
            Download full technical appendix (PDF)
          </a>
        </p>
      </div>

      <div class="card">
        <h2>Important notes</h2>
        <ul>
          <li>
            Cost templates are based on data provided by WHO, NIE and NCDC for frontline, intermediate
            and advanced FETP in India. These define default cost ranges and breakdowns.
          </li>
          <li>
            Benefit estimates based on DCE results reflect stakeholder willingness to pay for programme
            improvements, not actual budget allocations.
          </li>
          <li>
            Epidemiological multipliers and macroeconomic values are configurable in
            <code>config/epi_config.json</code> and should be refined with national experts.
          </li>
        </ul>
      </div>
    </section>

    <!-- CONFIGURATION -->
    <section id="configTab" class="tab-panel">
      <div class="grid-2">
        <div class="card">
          <h2>Programme configuration</h2>

          <label class="field-label">
            Programme tier
            <span class="info-pill" title="Frontline: 3 months, Intermediate: 12 months, Advanced: 24 months.">
              i
            </span>
          </label>
          <select id="tierSelect" class="select-input">
            <option value="frontline">Frontline (3 months)</option>
            <option value="intermediate">Intermediate (12 months)</option>
            <option value="advanced">Advanced (24 months)</option>
          </select>

          <label class="field-label">
            Mentorship intensity
            <span class="info-pill" title="Low, medium or high ongoing mentorship during training.">i</span>
          </label>
          <select id="mentorshipSelect" class="select-input">
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>

          <label class="field-label">
            Trainee career incentives
            <span class="info-pill" title="Certificate or more formal career pathway incentives.">i</span>
          </label>
          <select id="careerSelect" class="select-input">
            <option value="certificate">Government and partner certificate</option>
            <option value="university">University qualification</option>
            <option value="gov_pathway">Government career pathway</option>
          </select>

          <label class="field-label">
            Mode of delivery
            <span class="info-pill" title="Blended: mix of online and in person; others are fully in person or fully online.">i</span>
          </label>
          <select id="deliverySelect" class="select-input">
            <option value="blended">Blended</option>
            <option value="inperson">Fully in person</option>
            <option value="online">Fully online</option>
          </select>

          <label class="field-label">
            Outbreak response expectation
            <span class="info-pill" title="Expected time to respond to outbreaks following training.">i</span>
          </label>
          <select id="responseSelect" class="select-input">
            <option value="30">Respond within 30 days</option>
            <option value="15">Respond within 15 days</option>
            <option value="7">Respond within 7 days</option>
          </select>

          <label class="field-label">
            Programme duration (months)
          </label>
          <input type="number" id="durationInput" class="number-input" min="1" max="36" />

        </div>

        <div class="card">
          <h2>Costs and scale</h2>

          <label class="field-label">
            Cost template source
            <span class="info-pill"
                  title="Templates based on WHO, NIE and NCDC cost data for FETP in India. They set default cost levels and breakdowns.">
              i
            </span>
          </label>
          <select id="costTemplateSelect" class="select-input">
            <!-- options are filled dynamically based on tier -->
          </select>

          <div class="field-row">
            <label class="field-label">
              Include trainee opportunity cost
              <span class="info-pill" title="If on, trainee salary foregone during training is counted as social cost.">
                i
              </span>
            </label>
            <label class="switch">
              <input type="checkbox" id="oppCostToggle" checked />
              <span class="slider-round"></span>
            </label>
          </div>

          <label class="field-label">
            Cost per trainee per month (<span id="currencyLabel">INR</span>)
            <span class="info-pill"
                  title="Should stay within the DCE range of 75,000 to 400,000 rupees per trainee per month.">
              i
            </span>
          </label>
          <input type="range" id="costSlider" min="75000" max="400000" step="5000" />
          <div class="slider-value-row">
            <span id="costDisplay"></span>
            <span class="hint-text" id="costTemplateHint"></span>
          </div>

          <div class="field-row mt-2">
            <label class="field-label">Currency label</label>
            <select id="currencySelect" class="select-input small">
              <option value="INR">INR</option>
              <option value="USD">USD (approximate)</option>
            </select>
            <span class="hint-text">
              Internal calculations stay in INR. USD uses a fixed conversion factor from config.
            </span>
          </div>

          <label class="field-label">
            Trainees per cohort
          </label>
          <input type="number" id="cohortSizeInput" class="number-input" min="5" max="100" value="20" />

          <label class="field-label">
            Number of cohorts at national level
          </label>
          <input type="number" id="cohortsInput" class="number-input" min="1" max="200" value="10" />

          <div class="field-label">
            Preference model
            <span class="info-pill"
                  title="Use either the average mixed logit model or the training supporters latent class (Class 2).">
              i
            </span>
          </div>
          <div class="pill-toggle">
            <button type="button" class="pill-button active" data-model="mxl">Average mixed logit</button>
            <button type="button" class="pill-button" data-model="lc2">Supportive group (LC Class 2)</button>
          </div>

          <label class="field-label mt-2">
            Scenario notes (saved with this configuration)
          </label>
          <textarea id="scenarioNotes" class="text-input" rows="3"
                    placeholder="Example: High mentorship advanced tier, targeting priority states, assumes full budget availability."></textarea>

          <button id="runButton" class="primary-button">Run scenario</button>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="resultsTab" class="tab-panel">
      <div class="grid-2">
        <div class="card">
          <h2>Key indicators</h2>
          <div class="kpi-row">
            <div class="kpi">
              <div class="kpi-label">Endorsement probability</div>
              <div class="kpi-value" id="endorsementKpi">–</div>
              <div class="kpi-subtitle">Probability that stakeholders prefer this configuration over opting out</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Benefit - cost ratio</div>
              <div class="kpi-value" id="bcrKpi">–</div>
              <div class="kpi-subtitle">Based on DCE willingness to pay and total social cost</div>
            </div>
          </div>

          <div class="kpi-row">
            <div class="kpi">
              <div class="kpi-label">Net benefit per cohort</div>
              <div class="kpi-value" id="netBenefitKpi">–</div>
              <div class="kpi-subtitle" id="netBenefitSubtitle"></div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Total cost (national scale)</div>
              <div class="kpi-value" id="totalCostKpi">–</div>
              <div class="kpi-subtitle">Includes training costs and opportunity costs if toggled on</div>
            </div>
          </div>

          <div class="kpi-row">
            <div class="kpi">
              <div class="kpi-label">Total trainees (all cohorts)</div>
              <div class="kpi-value" id="totalTraineesKpi">–</div>
              <div class="kpi-subtitle">Across all cohorts at national level</div>
            </div>
            <div class="kpi">
              <div class="kpi-label">Approx. additional epidemiologists</div>
              <div class="kpi-value" id="epiGainKpi">–</div>
              <div class="kpi-subtitle">Based on epi multipliers in config</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Visual summary</h2>
          <canvas id="summaryChart"></canvas>
          <p class="hint-text">
            The chart shows costs and DCE-based benefits per cohort. Epidemiological gains are reported as separate counts.
          </p>

          <div class="button-row mt-2">
            <button id="downloadPdfBtn" class="secondary-button">Download policy brief (PDF)</button>
            <button id="downloadExcelBtn" class="secondary-button">Download summary (Excel)</button>
          </div>
        </div>
      </div>

      <div class="card mt-3">
        <h2>Interpretation and recommendation</h2>
        <p id="headlineRecommendation" class="headline-text"></p>
        <p id="detailedRecommendation"></p>
      </div>
    </section>

    <!-- SCENARIO LIBRARY -->
    <section id="libraryTab" class="tab-panel">
      <div class="card">
        <h2>Saved scenarios</h2>
        <p class="hint-text">
          Save multiple configurations and compare them side by side. Saved scenarios include notes, key outputs and whether
          they use the average MXL model or the supportive group latent class.
        </p>
        <button id="saveScenarioBtn" class="secondary-button">Save current scenario</button>
        <button id="clearScenariosBtn" class="ghost-button">Clear all saved scenarios</button>

        <div id="scenarioTableContainer" class="table-container mt-2"></div>
      </div>
    </section>

    <!-- COST TEMPLATES -->
    <section id="costTab" class="tab-panel">
      <div class="card">
        <h2>Cost templates and breakdown</h2>
        <p>
          Cost templates are derived from data provided by WHO, NIE and NCDC. They summarise the main cost components
          for each tier and provide a baseline cost per trainee per month that is aligned with the DCE cost range.
        </p>
        <p>
          When you change the programme tier and template source in the configuration tab, STEPS updates the suggested
          cost per trainee per month and the breakdown below.
        </p>

        <label class="field-label">
          Select tier and template to inspect
        </label>
        <div class="grid-2">
          <select id="costTierInspectSelect" class="select-input">
            <option value="frontline">Frontline</option>
            <option value="intermediate">Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>

          <select id="costTemplateInspectSelect" class="select-input">
            <!-- populated dynamically -->
          </select>
        </div>

        <div id="costBreakdownContainer" class="table-container mt-2"></div>
      </div>
    </section>
  </main>

  <!-- External libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- App logic -->
  <script src="script.js"></script>
</body>
</html>
